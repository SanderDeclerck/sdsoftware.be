name: 'Deploy'

on:
  push:
    branches:
      - main
      
jobs:

  deploy_infrastructure:
    name: '🏢 Deploy infrastructure'
    runs-on: 'ubuntu-latest'

    permissions:
      id-token: write
    
    steps:
    - name: '⚙️ Prepare: Checkout code'
      uses: 'actions/checkout@v1'

    - name: '⚙️ Prepare: Login to Azure'
      uses: 'azure/login@v1'
      with:
        client-id: ${{ secrets.ACTIVE_DIRECTORY_APPLICATION_OBJECT_ID }}
        tenant-id: ${{ secrets.ACTIVE_DIRECTORY_ID }}
        subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }} 
        enable-AzPSSession: true
    
  deploy_app:
    name: '🚀 Deploy application'
    runs-on: 'ubuntu-latest'
    needs: 'deploy_infrastructure'
    
    steps:
    - name: '⚙️ Prepare: Checkout code'
      uses: 'actions/checkout@v1'
    
